<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Screen Position Calibrator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #111;
            color: #fff;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow: auto;
            cursor: crosshair;
        }
        .container { position: relative; display: inline-block; }
        img { display: block; }
        .crosshair-h, .crosshair-v {
            position: fixed;
            pointer-events: none;
            z-index: 100;
        }
        .crosshair-h {
            width: 100%;
            height: 1px;
            left: 0;
            background: rgba(255, 50, 50, 0.6);
        }
        .crosshair-v {
            width: 1px;
            height: 100%;
            top: 0;
            background: rgba(255, 50, 50, 0.6);
        }
        .marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border: 2px solid #ff3333;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 90;
        }
        .marker::after {
            content: attr(data-label);
            position: absolute;
            left: 16px;
            top: -4px;
            font-size: 13px;
            color: #ff3333;
            white-space: nowrap;
            font-weight: bold;
        }
        .rect-overlay {
            position: absolute;
            border: 2px dashed #00ff88;
            pointer-events: none;
            z-index: 80;
        }
        .rect-overlay::after {
            content: attr(data-dims);
            position: absolute;
            bottom: -22px;
            left: 0;
            font-size: 12px;
            color: #00ff88;
            white-space: nowrap;
        }
        .panel {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 200;
            background: rgba(0, 0, 0, 0.92);
            padding: 20px 28px;
            border: 1px solid #444;
            border-radius: 10px;
            min-width: 320px;
            backdrop-filter: blur(10px);
        }
        .panel h2 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #ff6b6b;
            letter-spacing: 1px;
        }
        .panel .pos {
            font-size: 22px;
            color: #fff;
            margin-bottom: 16px;
        }
        .panel .pos b { color: #ff6b6b; }
        .clicks-list { border-top: 1px solid #333; padding-top: 12px; }
        .click-item {
            color: #4ade80;
            font-size: 14px;
            line-height: 1.8;
        }
        .css-output {
            margin-top: 14px;
            padding: 14px;
            background: #1a1a2e;
            border-radius: 6px;
            border: 1px solid #333;
        }
        .css-output div {
            color: #ff6b6b;
            font-size: 14px;
            font-weight: bold;
            line-height: 1.8;
        }
        .css-output .prop { color: #7dd3fc; }
        .css-output .val { color: #fbbf24; }
        .instructions {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.92);
            padding: 14px 28px;
            border-radius: 10px;
            border: 1px solid #444;
            font-size: 14px;
            color: #ccc;
            z-index: 200;
            text-align: center;
            max-width: 700px;
            line-height: 1.6;
        }
        .instructions b { color: #ff6b6b; }
        .instructions .key { 
            display: inline-block;
            background: #333;
            padding: 2px 8px;
            border-radius: 4px;
            color: #fff;
            font-size: 12px;
        }
        .btn-reset {
            margin-top: 12px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
        }
        .btn-reset:hover { background: #444; }
    </style>
</head>
<body>
    <div class="container" id="container">
        <img src="images/EspressoMachine.png" id="img" draggable="false">
    </div>
    <div class="crosshair-h" id="ch"></div>
    <div class="crosshair-v" id="cv"></div>
    <div class="panel">
        <h2>SCREEN CALIBRATOR</h2>
        <div class="pos">Cursor: <b id="pos">--, --</b></div>
        <div class="clicks-list" id="clicks">
            <div style="color:#888;font-size:13px">Click <b style="color:#ff6b6b">top-left</b> corner of the screen, then <b style="color:#ff6b6b">bottom-right</b> corner.</div>
        </div>
        <button class="btn-reset" onclick="resetClicks()">Reset Clicks (R)</button>
    </div>
    <div class="instructions">
        <b>Step 1:</b> Click the <b>top-left corner</b> of the machine's dark screen area. &nbsp;
        <b>Step 2:</b> Click the <b>bottom-right corner</b>. &nbsp;
        <b>Step 3:</b> Copy the CSS values shown in the panel. &nbsp;
        <span class="key">R</span> to reset.
    </div>
    <!-- Background music: attempt muted autoplay, then unmute & fade-in on first interaction -->
    <audio id="bgMusic" src="audio/music.mp3" loop preload="auto" crossorigin="anonymous"></audio>

    <script>
    (function(){
        function fadeIn(audioEl, targetVol, durationMs){
            audioEl.volume = 0;
            var STEPS = 80;
            var stepTime = durationMs / STEPS;
            var stepVol = targetVol / STEPS;
            var i = 0;
            var iv = setInterval(function(){
                i++;
                audioEl.volume = Math.min(targetVol, parseFloat((stepVol * i).toFixed(4)));
                if(i >= STEPS) clearInterval(iv);
            }, stepTime);
        }

        var bg = document.getElementById('bgMusic');
        bg.volume = 0;

        function tryStartMuted() {
            // Start muted playback (muted autoplay is allowed in most browsers)
            bg.muted = true;
            bg.play().then(function(){
                // Muted playback succeeded. Unmute on the first user gesture and fade in.
                function enableSoundOnce(){
                    bg.muted = false;
                    fadeIn(bg, 0.18, 4000);
                }
                document.addEventListener('click', enableSoundOnce, { once: true });
                document.addEventListener('touchstart', enableSoundOnce, { once: true });
            }).catch(function(){
                // Muted autoplay failed (rare). Fallback to starting on first user gesture.
                function startOnInteraction(){
                    bg.muted = false;
                    bg.play().then(function(){ fadeIn(bg, 0.18, 4000); }).catch(function(){});
                }
                document.addEventListener('click', startOnInteraction, { once: true });
                document.addEventListener('touchstart', startOnInteraction, { once: true });
            });
        }

        // Attempt immediately
        tryStartMuted();
    })();
    </script>

    <script>
        var img = document.getElementById('img');
        var container = document.getElementById('container');
        var ch = document.getElementById('ch');
        var cv = document.getElementById('cv');
        var posEl = document.getElementById('pos');
        var clicksEl = document.getElementById('clicks');
        var clickPoints = [];
        var markers = [];
        var rectOverlay = null;

        document.addEventListener('mousemove', function (e) {
            ch.style.top = e.clientY + 'px';
            cv.style.left = e.clientX + 'px';
            var rect = img.getBoundingClientRect();
            var x = Math.round(e.clientX - rect.left);
            var y = Math.round(e.clientY - rect.top);
            posEl.textContent = x + ', ' + y;
        });

        img.addEventListener('click', function (e) {
            if (clickPoints.length >= 2) return;
            var rect = img.getBoundingClientRect();
            var x = Math.round(e.clientX - rect.left);
            var y = Math.round(e.clientY - rect.top);
            clickPoints.push({ x: x, y: y });

            // Add visual marker
            var marker = document.createElement('div');
            marker.className = 'marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.setAttribute('data-label', clickPoints.length === 1 ? 'TOP-LEFT (' + x + ', ' + y + ')' : 'BOTTOM-RIGHT (' + x + ', ' + y + ')');
            container.appendChild(marker);
            markers.push(marker);

            updatePanel();
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'r' || e.key === 'R') resetClicks();
        });

        function resetClicks() {
            clickPoints = [];
            markers.forEach(function (m) { m.remove(); });
            markers = [];
            if (rectOverlay) { rectOverlay.remove(); rectOverlay = null; }
            updatePanel();
        }

        function updatePanel() {
            var html = '';
            if (clickPoints.length === 0) {
                html = '<div style="color:#888;font-size:13px">Click <b style="color:#ff6b6b">top-left</b> corner of the screen, then <b style="color:#ff6b6b">bottom-right</b> corner.</div>';
            }
            clickPoints.forEach(function (p, i) {
                var label = i === 0 ? 'Top-Left' : 'Bottom-Right';
                html += '<div class="click-item">' + label + ': (' + p.x + ', ' + p.y + ')</div>';
            });

            if (clickPoints.length >= 2) {
                var tl = clickPoints[0];
                var br = clickPoints[1];
                var w = br.x - tl.x;
                var h = br.y - tl.y;

                // Draw rectangle overlay
                if (rectOverlay) rectOverlay.remove();
                rectOverlay = document.createElement('div');
                rectOverlay.className = 'rect-overlay';
                rectOverlay.style.left = tl.x + 'px';
                rectOverlay.style.top = tl.y + 'px';
                rectOverlay.style.width = w + 'px';
                rectOverlay.style.height = h + 'px';
                rectOverlay.setAttribute('data-dims', w + ' Ã— ' + h + 'px');
                container.appendChild(rectOverlay);

                html += '<div class="css-output">';
                html += '<div style="color:#aaa;font-size:12px;margin-bottom:8px">Copy these into styles.css :root</div>';
                html += '<div><span class="prop">--screen-left:</span> <span class="val">' + tl.x + 'px</span>;</div>';
                html += '<div><span class="prop">--screen-top:</span> <span class="val">' + tl.y + 'px</span>;</div>';
                html += '<div><span class="prop">--screen-w:</span> <span class="val">' + w + 'px</span>;</div>';
                html += '<div><span class="prop">--screen-h:</span> <span class="val">' + h + 'px</span>;</div>';
                html += '</div>';
            }

            clicksEl.innerHTML = html;
        }
    </script>
</body>
</html>
